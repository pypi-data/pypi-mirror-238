"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[21466],{21466:function(e,t,r){r.r(t);var n,i=require("@babel/runtime/helpers/taggedTemplateLiteral").default,a=require("@babel/runtime/helpers/defineProperty").default,s=require("@babel/runtime/helpers/classCallCheck").default,o=require("@babel/runtime/helpers/createClass").default,c=require("@babel/runtime/helpers/inherits").default,u=require("@babel/runtime/helpers/createSuper").default,l=require("@babel/runtime/helpers/regeneratorRuntime").default,f=require("@babel/runtime/helpers/slicedToArray").default,d=require("@babel/runtime/helpers/createForOfIteratorHelper").default,h=require("@babel/runtime/helpers/asyncToGenerator").default,p=require("@babel/runtime/helpers/typeof").default;!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==p(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e){e.exports=JSON.parse('{"name":"hui-ais-auto-entities-card","private":true,"version":"1.7.0","description":"","scripts":{"build":"webpack","watch":"webpack --watch --mode=development","update-card-tools":"npm uninstall card-tools && npm install thomasloven/lovelace-card-tools"},"author":"Thomas Lov√©n","license":"MIT","devDependencies":{"webpack":"^4.44.2","webpack-cli":"^3.3.12"},"dependencies":{"card-tools":"github:thomasloven/lovelace-card-tools"}}')},function(e,t,r){r.r(t);var g=customElements.get("home-assistant-main")?Object.getPrototypeOf(customElements.get("home-assistant-main")):Object.getPrototypeOf(customElements.get("hui-view")),m=g.prototype.html;function v(){return document.querySelector("hc-main")?document.querySelector("hc-main").hass:document.querySelector("home-assistant")?document.querySelector("home-assistant").hass:void 0}g.prototype.css;var y=v().callWS({type:"config/area_registry/list"}),b=v().callWS({type:"config/device_registry/list"}),w=v().callWS({type:"config/entity_registry/list"});function _(){return S.apply(this,arguments)}function S(){return(S=h(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=window.cardToolsData,e.t0){e.next=12;break}return e.next=4,y;case 4:return e.t1=e.sent,e.next=7,b;case 7:return e.t2=e.sent,e.next=10,w;case 10:e.t3=e.sent,e.t0={areas:e.t1,devices:e.t2,entities:e.t3};case 12:return window.cardToolsData=e.t0,e.abrupt("return",window.cardToolsData);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){var t=window.cardToolsData,r=[];if(!e)return r;var n,i=d(t.devices);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.area_id===e.area_id&&r.push(a)}}catch(s){i.e(s)}finally{i.f()}return r}function O(e){var t=window.cardToolsData,r=[];if(!e)return r;var n,i=d(t.entities);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.device_id===e.id&&r.push(a.entity_id)}}catch(s){i.e(s)}finally{i.f()}return r}function E(e,t){if("string"==typeof t&&"string"==typeof e&&(e.startsWith("/")&&e.endsWith("/")||-1!==e.indexOf("*")))return e.startsWith("/")||(e="/^".concat(e=e.replace(/\./g,".").replace(/\*/g,".*"),"$/")),new RegExp(e.slice(1,-1)).test(t);if("string"==typeof e){if(e.startsWith("<="))return parseFloat(t)<=parseFloat(e.substr(2));if(e.startsWith(">="))return parseFloat(t)>=parseFloat(e.substr(2));if(e.startsWith("<"))return parseFloat(t)<parseFloat(e.substr(1));if(e.startsWith(">"))return parseFloat(t)>parseFloat(e.substr(1));if(e.startsWith("!"))return parseFloat(t)!=parseFloat(e.substr(1));if(e.startsWith("="))return parseFloat(t)==parseFloat(e.substr(1))}return e===t}function T(e,t){return function(r){var n="string"==typeof r?e.states[r]:e.states[r.entity];if(!n)return!1;for(var i=0,a=Object.entries(t);i<a.length;i++){var s=f(a[i],2),o=(s[0],s[1]);switch(m.split(" ")[0]){case"options":case"sort":break;case"domain":if(!E(o,n.entity_id.split(".")[0]))return!1;break;case"entity_id":if(!E(o,n.entity_id))return!1;break;case"state":if(!E(o,n.state))return!1;break;case"name":if(!n.attributes.friendly_name||!E(o,n.attributes.friendly_name))return!1;break;case"group":if(!(o.startsWith("group.")&&e.states[o]&&e.states[o].attributes.entity_id&&e.states[o].attributes.entity_id.includes(n.entity_id)))return!1;break;case"attributes":for(var c=0,u=Object.entries(o);c<u.length;c++){for(var l=f(u[c],2),h=l[0],p=l[1],g=h.split(" ")[0].trim(),v=n.attributes;g&&v;){var y,b,w;y=g.split(":"),w=(b=f(y,2))[0],g=b[1],v=v[w]}if(void 0===v||void 0!==p&&!E(p,v))return!1}break;case"not":if(T(e,o)(r))return!1;break;case"or":var _,S=d(o);try{for(S.s();!(_=S.n()).done;){var C=_.value;if(T(e,C)(r))return!0}}catch(I){S.e(I)}finally{S.f()}return!1;case"device":if(!window.cardToolsData||!window.cardToolsData.devices)return!1;var D,q=!1,j=d(window.cardToolsData.devices);try{for(j.s();!(D=j.n()).done;){var x=D.value;(E(o,x.name_by_user)||E(o,x.name))&&O(x).includes(n.entity_id)&&(q=!0)}}catch(I){j.e(I)}finally{j.f()}if(!q)return!1;break;case"area":if(!window.cardToolsData||!window.cardToolsData.areas)return!1;var N,F=!1,W=d(window.cardToolsData.areas);try{for(W.s();!(N=W.n()).done;){var R=N.value;E(o,R.name)&&k(R).flatMap(O).includes(n.entity_id)&&(F=!0)}}catch(I){W.e(I)}finally{W.f()}if(!F)return!1;break;case"last_changed":if(!E(o,((new Date).getTime()-new Date(n.last_changed).getTime())/6e4))return!1;break;case"last_updated":if(!E(o,((new Date).getTime()-new Date(n.last_updated).getTime())/6e4))return!1;break;default:return!1}}return!0}}function C(e,t){return"string"==typeof t&&(t={method:t}),function(r,n){var i="string"==typeof r?e.states[r]:e.states[r.entity],a="string"==typeof n?e.states[n]:e.states[n.entity];if(void 0===i||void 0===a)return 0;var s=t.reverse?[-1,1]:[1,-1],o=f(s,2),c=o[0],u=o[1];function l(e,r){return t.ignore_case&&e.toLowerCase&&(e=e.toLowerCase()),t.ignore_case&&r.toLowerCase&&(r=r.toLowerCase()),t.numeric&&(isNaN(parseFloat(e))&&isNaN(parseFloat(r))||(e=isNaN(parseFloat(e))?void 0:parseFloat(e),r=isNaN(parseFloat(r))?void 0:parseFloat(r))),void 0===e&&void 0===r?0:void 0===e?c:void 0===r||e<r?u:e>r?c:0}switch(t.method){case"domain":return l(i.entity_id.split(".")[0],a.entity_id.split(".")[0]);case"entity_id":return l(i.entity_id,a.entity_id);case"friendly_name":case"name":return l(i.attributes.friendly_name||i.entity_id.split(".")[1],a.attributes.friendly_name||a.entity_id.split(".")[1]);case"state":return l(i.state,a.state);case"attribute":for(var d=i.attributes,h=a.attributes,p=t.attribute;p;){var g,m,v;if(g=p.split(":"),v=(m=f(g,2))[0],p=m[1],d=d[v],h=h[v],void 0===d&&void 0===h)return 0;if(void 0===d)return c;if(void 0===h)return u}return l(d,h);case"last_changed":return t.numeric=!0,l(new Date(a.last_changed).getTime(),new Date(i.last_changed).getTime());case"last_updated":return t.numeric=!0,l(new Date(a.last_updated).getTime(),new Date(i.last_updated).getTime());case"last_triggered":return null==i.attributes.last_triggered||null==a.attributes.last_triggered?0:(t.numeric=!0,l(new Date(a.attributes.last_triggered).getTime(),new Date(i.attributes.last_triggered).getTime()));default:return 0}}}function D(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((e=new Event(e,{bubbles:!0,cancelable:!1,composed:!0})).detail=t||{},r)r.dispatchEvent(e);else{var n=function(){var e=document.querySelector("hc-main");return e?(e=(e=(e=e&&e.shadowRoot)&&e.querySelector("hc-lovelace"))&&e.shadowRoot)&&e.querySelector("hui-view")||e.querySelector("hui-panel-view"):(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=document.querySelector("home-assistant"))&&e.shadowRoot)&&e.querySelector("home-assistant-main"))&&e.shadowRoot)&&e.querySelector("app-drawer-layout partial-panel-resolver"))&&e.shadowRoot||e)&&e.querySelector("ha-panel-lovelace"))&&e.shadowRoot)&&e.querySelector("hui-root"))&&e.shadowRoot)&&e.querySelector("ha-app-layout"))&&e.querySelector("#view"))&&e.firstElementChild}();n&&n.dispatchEvent(e)}}_();var q=window.cardHelpers,j=new Promise(function(){var e=h(l().mark((function e(t,r){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:q&&t(),n=function(){var e=h(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadCardHelpers();case 2:q=e.sent,window.cardHelpers=q,t();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),window.loadCardHelpers?n():window.addEventListener("load",h(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h(l().mark((function e(){var t,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!customElements.get("hui-view")){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,customElements.whenDefined("partial-panel-resolver");case 4:return(t=document.createElement("partial-panel-resolver")).hass={panels:[{url_path:"tmp",component_name:"lovelace"}]},t._updateRoutes(),e.next=9,t.routerOptions.routes.tmp.load();case 9:if(customElements.get("ha-panel-lovelace")){e.next=11;break}return e.abrupt("return",!1);case 11:if((r=document.createElement("ha-panel-lovelace")).hass=v(),e.t0=void 0===r.hass,!e.t0){e.next=18;break}return e.next=17,new Promise((function(e){window.addEventListener("connection-status",(function(t){console.log(t),e()}),{once:!0})}));case 17:r.hass=v();case 18:r.panel={config:{mode:null}},r._fetchConfig();case 20:case"end":return e.stop()}}),e)})))(),window.loadCardHelpers&&n();case 1:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());function x(e,t){var r={type:"error",error:e,origConfig:t},n=document.createElement("hui-error-card");return customElements.whenDefined("hui-error-card").then((function(){var e=document.createElement("hui-error-card");e.setConfig(r),n.parentElement&&n.parentElement.replaceChild(e,n)})),j.then((function(){D("ll-rebuild",{},n)})),n}var N="lovelace-player-device-id";function F(){if(!localStorage[N]){var e=function(){return Math.floor(1e5*(1+Math.random())).toString(16).substring(1)};window.fully&&"function"==typeof fully.getDeviceId?localStorage[N]=fully.getDeviceId():localStorage[N]="".concat(e()).concat(e(),"-").concat(e()).concat(e())}return localStorage[N]}var W,R=F(),I=new URLSearchParams(window.location.search);I.get("deviceID")&&null!==(W=I.get("deviceID"))&&("clear"===W?localStorage.removeItem(N):localStorage[N]=W,R=F());var L=function(e){c(r,e);var t=u(r);function r(){return s(this,r),t.apply(this,arguments)}return o(r,[{key:"setConfig",value:function(e){var t=this;if(!e)throw new Error("No configuration.");if(!e.card||!e.card.type)throw new Error("No card type specified.");if(!e.filter&&!e.entities)throw new Error("No filters specified.");e=JSON.parse(JSON.stringify(e)),this._config?(this._config=e,this.hass=this.hass):(this._config=e,this.hass=v(),this._getEntities(),this.cardConfig=Object.assign(a({},e.card_param||"entities",this.entities),e.card),this.card=function(e){return q?q.createCardElement(e):function(e,t){if(!t||"object"!=p(t)||!t.type)return x("No ".concat(e," type configured"),t);var r=t.type;if(r=r.startsWith("custom:")?r.substr(7):"hui-".concat(r,"-").concat(e),customElements.get(r))return function(e,t){var r=document.createElement(e);try{r.setConfig(JSON.parse(JSON.stringify(t)))}catch(e){r=x(e,t)}return j.then((function(){D("ll-rebuild",{},r)})),r}(r,t);var n=x("Custom element doesn't exist: ".concat(r,"."),t);n.style.display="None";var i=setTimeout((function(){n.style.display=""}),2e3);return customElements.whenDefined(r).then((function(){clearTimeout(i),D("ll-rebuild",{},n)})),n}("card",e)}(this.cardConfig)),e.filter&&e.filter.template&&(this.template="",(String(e.filter.template).includes("{%")||String(e.filter.template).includes("{{"))&&function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e||(e=v().connection);var i=Object.assign({user:v().user.name,browser:R,hash:location.hash.substr(1)||" "},r.variables),a=r.template,s=r.entity_ids;e.subscribeMessage((function(e){if(n){var r=String(e.result);r=r.replace(/_\([^)]*\)/g,(function(e){return v().localize(e.substring(2,e.length-1))||e})),t(r)}else t(e.result)}),{type:"render_template",template:a,variables:i,entity_ids:s})}(null,(function(e){t.template=e,t._getEntities()}),{template:e.filter.template,variables:{config:e},entity_ids:e.filter.entity_ids},!1)),_().then((function(){return t._getEntities()}))}},{key:"_getEntities",value:function(){var e=this,t=function(e){return e?"string"==typeof e?{entity:e.trim()}:e:null},r=[];if(this._config.entities&&(r=r.concat(this._config.entities.map(t))),this.hass&&this._config.filter){if(this.template&&(r="string"==typeof this.template?r.concat(this.template.split(/[\s,]+/).map(t)):r.concat(this.template.map(t))),r=r.filter(Boolean),this._config.filter.include){var n,i=Object.keys(this.hass.states).map(t),a=d(this._config.filter.include);try{var s=function(){var t=n.value;if(void 0!==t.type)return r.push(t),1;var a=i.filter(T(e.hass,t)).map((function(e){return JSON.parse(JSON.stringify(new Object(Object.assign(Object.assign({},e),t.options))).replace(/this.entity_id/g,e.entity))}));void 0!==t.sort&&(a=a.sort(C(e.hass,t.sort))),r=r.concat(a)};for(a.s();!(n=a.n()).done;)s()}catch(y){a.e(y)}finally{a.f()}}if(this._config.filter.exclude){var o,c=d(this._config.filter.exclude);try{var u=function(){var t=o.value;r=r.filter((function(r){return"string"!=typeof r&&void 0===r.entity||!T(e.hass,t)(r)}))};for(c.s();!(o=c.n()).done;)u()}catch(y){c.e(y)}finally{c.f()}}if(this._config.sort&&(r=r.sort(C(this.hass,this._config.sort)),this._config.sort.count)){var l=this._config.sort.first||0;r=r.slice(l,l+this._config.sort.count)}if(this._config.unique){var f,h=function e(t,r){return p(t)==p(r)&&("object"!=p(t)?t===r:Object.keys(t).lenght===Object.keys(r).length&&!Object.keys(t).some((function(e){return!Object.keys(r).includes(e)}))&&Object.keys(t).every((function(n){return e(t[n],r[n])})))},g=[],m=d(r);try{var v=function(){var t=f.value;"entity"===e._config.unique&&g.some((function(e){return e.entity===t.entity}))||g.some((function(e){return h(e,t)}))||g.push(t)};for(m.s();!(f=m.n()).done;)v()}catch(y){m.e(y)}finally{m.f()}r=g}this.entities=r}else this.entities=r}},{key:"entities",get:function(){return this._entities},set:function(e){(function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(JSON.stringify(e[r])!==JSON.stringify(t[r]))return!1;return!0})(e,this._entities)||(this._entities=e,this.cardConfig=Object.assign(Object.assign({},this.cardConfig),{},{entities:this._entities}),0===e.length&&!1===this._config.show_empty?(this.style.display="none",this.style.margin="0"):(this.style.display=null,this.style.margin=null))}},{key:"cardConfig",get:function(){return this._cardConfig},set:function(e){this._cardConfig=e,this.card&&this.card.setConfig(e)}},{key:"updated",value:function(e){var t=this;e.has("hass")&&this.hass&&(this.card.hass=this.hass,setTimeout((function(){return t._getEntities()}),0))}},{key:"createRenderRoot",value:function(){return this}},{key:"render",value:function(){return m(n||(n=i(["\n    ",""])),this.card)}},{key:"getCardSize",value:function(){var e=0;return this.card&&this.card.getCardSize&&(e=this.card.getCardSize()),1===e&&this.entities.length&&(e=this.entities.length),0===e&&this._config.filter&&this._config.filter.include&&(e=Object.keys(this._config.filter.include).length),e||1}}],[{key:"properties",get:function(){return{hass:{}}}}]),r}(g);if(!customElements.get("hui-ais-auto-entities-card")){customElements.define("hui-ais-auto-entities-card",L);var P=r(0);console.info("%cAUTO-ENTITIES ".concat(P.version," IS INSTALLED"),"color: green; font-weight: bold","")}}])}}]);
//# sourceMappingURL=21466-PA5k8jSn2vU.js.map