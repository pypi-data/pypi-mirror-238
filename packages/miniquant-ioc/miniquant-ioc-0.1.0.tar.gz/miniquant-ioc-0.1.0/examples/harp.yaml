harp:
  device: "first"

  init:
    measurementMode: Histogramming
    referenceClock: Internal

  presets:
    - name: "kmc3-tau0"
      settings:
        syncDiv: 1
        syncCfd:
          level: 0.030
          zerox: 0.010

        syncChannelOffset: 0

        histogramLength: 6
        binning: 8
        offset: 0

        clearOnAcquire: True

        measurementControl:
          control: SingleShotCtc
          startEdge: Falling
          stopEdge: Falling

        channels:

        - enabled: True
          offset: 0
          clearOnReadout: False
          cfd:
            level: 0.005
            zerox: 0.001

        - enabled: False

        - enabled: False

        - enabled: False


    - name: "thomas1"
      settings:
        syncDiv: 1
        syncCfd:
          level: 0.300
          zerox: 0.020

        syncChannelOffset: 0

        # Histogram length is in power of 2, refering to Ksamples
        histogramLength: 6

        # Binning is in power of 2 of the base resolution
        binning: 6

        offset: 0

        clearOnAcquire: True

        measurementControl:
          control: SingleShotCtc
          startEdge: Falling
          stopEdge: Falling

        channels:

        - enabled: True
          offset: 0
          clearOnReadout: False
          cfd:
            level: 0.160
            zerox: 0.020

        - enabled: True
          offset: 0
          clearOnReadout: False
          cfd:
            level: 0.200
            zerox: 0.020

        - enabled: False

        - enabled: False


    - name: "tau0set1"
      settings:
        syncDiv: 1
        syncCfd:
          level: 0.030
          zerox: 0.020

        syncChannelOffset: 0

        # Histogram length is in power of 2, refering to Ksamples
        histogramLength: 6

        # Binning is in power of 2 of the base resolution
        binning: 6

        offset: 0

        clearOnAcquire: True

        measurementControl:
          control: SingleShotCtc
          startEdge: Falling
          stopEdge: Falling

        channels:

        - enabled: True
          offset: 0
          clearOnReadout: False
          cfd:
            level: 0.003
            zerox: 0.000

        - enabled: False
        - enabled: False
        - enabled: False

    - name: "pmt"
      settings:
        syncDiv: 1
        syncCfd:
          level: 0.300
          zerox: 0.020

        syncChannelOffset: 0

        # Histogram length is in power of 2, refering to Ksamples
        histogramLength: 6

        # Binning is in power of 2 of the base resolution
        binning: 6

        offset: 0

        clearOnAcquire: True

        measurementControl:
          control: SingleShotCtc
          startEdge: Falling
          stopEdge: Falling

        channels:

        - enabled: False

        - enabled: True
          offset: 0
          clearOnReadout: False
          cfd:
            level: 0.160
            zerox: 0.020

        - enabled: False
        - enabled: False

  settings:
    fromPreset: "kmc3-tau0"

epics:

  prefix: "KMC3:XPP:HARP"

  # Default polling interval for harp and channel
  # properties exported to EPICS
  defaults:
    signal:
      pollPeriod: 0.5

  harpBase:
    exports:

      - recordType: signal
        signal:
          name: resolution
          kind: "analog"

      - recordType: signal
        signal:
          name: syncRate
          kind: "analog"
          killOnError: true          

      - recordType: signal
        signal:
          name: syncPeriod
          kind: "analog"

      - recordType: property
        property:
          name: acquiring
          kind: "switch"
          validator:
            values:
              1: true
              0: false

      - recordType: property
        property:
          name: acquisitionTime
          kind: "analog"


      - recordType: signal
        signal:
          name: flag_aqactive
          access: flags.ACTIVE
          kind: "analog"


  harpChannels:
    interfix: "ch{}_"
    exports:

      - recordType: property
        property:
          name: enabled
          kind: "switch"

      - recordType: signal
        signal:
          name: countRate
          kind: "analog"

      - recordType: signal
        signal:
          name: histogram
          suffix: histogram_signal
          kind: "waveform"
          create:
            length: 65536
            FTVL: "ULONG"

      - recordType: signal
        signal:
          name: offset
          suffix: histogram_offset
          kind: "analog"

      - recordType: signal
        signal:
          name: harp.resolution
          suffix: histogram_delta
          kind: "analog"
