{"version":3,"file":"file-url-d32e654f.js","sources":["../../../../js/wasm/network/host.ts","../../../../js/wasm/svelte/file-url.ts"],"sourcesContent":["export function is_self_host(url: URL): boolean {\n\treturn (\n\t\turl.host === window.location.host ||\n\t\turl.host === \"localhost:7860\" ||\n\t\turl.host === \"127.0.0.1:7860\" || // Ref: https://github.com/gradio-app/gradio/blob/v3.32.0/js/app/src/Index.svelte#L194\n\t\turl.host === \"lite.local\" // A special hostname set when the endpoint is a local file (`file:/*`). See `determine_protocol()` in `client/js/src/utils.ts`\n\t);\n}\n","import { getWorkerProxyContext } from \"./context\";\nimport { is_self_host } from \"../network/host\";\n\ntype MediaSrc = string | undefined | null;\n\nexport async function resolve_wasm_src(src: MediaSrc): Promise<MediaSrc> {\n\tif (src == null) {\n\t\treturn src;\n\t}\n\n\tconst url = new URL(src);\n\tif (!is_self_host(url)) {\n\t\t// `src` is not accessing a local server resource, so we don't need to proxy this request to the Wasm worker.\n\t\treturn src;\n\t}\n\tif (url.protocol !== \"http:\" && url.protocol !== \"https:\") {\n\t\t// `src` can be a data URL.\n\t\treturn src;\n\t}\n\n\tconst maybeWorkerProxy = getWorkerProxyContext();\n\tif (maybeWorkerProxy == null) {\n\t\t// We are not in the Wasm env. Just use the src as is.\n\t\treturn src;\n\t}\n\n\tconst path = url.pathname;\n\treturn maybeWorkerProxy\n\t\t.httpRequest({\n\t\t\tmethod: \"GET\",\n\t\t\tpath,\n\t\t\theaders: {},\n\t\t\tquery_string: \"\"\n\t\t})\n\t\t.then((response) => {\n\t\t\tif (response.status !== 200) {\n\t\t\t\tthrow new Error(`Failed to get file ${path} from the Wasm worker.`);\n\t\t\t}\n\t\t\tconst blob = new Blob([response.body], {\n\t\t\t\ttype: response.headers[\"Content-Type\"]\n\t\t\t});\n\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\treturn blobUrl;\n\t\t});\n}\n"],"names":["is_self_host","url","resolve_wasm_src","src","maybeWorkerProxy","getWorkerProxyContext","path","response","blob"],"mappings":"wCAAO,SAASA,EAAaC,EAAmB,CAE9C,OAAAA,EAAI,OAAS,OAAO,SAAS,MAC7BA,EAAI,OAAS,kBACbA,EAAI,OAAS,kBACbA,EAAI,OAAS,YAEf,CCFA,eAAsBC,EAAiBC,EAAkC,CACxE,GAAIA,GAAO,KACH,OAAAA,EAGF,MAAAF,EAAM,IAAI,IAAIE,CAAG,EAKvB,GAJI,CAACH,EAAaC,CAAG,GAIjBA,EAAI,WAAa,SAAWA,EAAI,WAAa,SAEzC,OAAAE,EAGR,MAAMC,EAAmBC,IACzB,GAAID,GAAoB,KAEhB,OAAAD,EAGR,MAAMG,EAAOL,EAAI,SACjB,OAAOG,EACL,YAAY,CACZ,OAAQ,MACR,KAAAE,EACA,QAAS,CAAC,EACV,aAAc,EAAA,CACd,EACA,KAAMC,GAAa,CACf,GAAAA,EAAS,SAAW,IACvB,MAAM,IAAI,MAAM,sBAAsBD,CAAI,wBAAwB,EAEnE,MAAME,EAAO,IAAI,KAAK,CAACD,EAAS,IAAI,EAAG,CACtC,KAAMA,EAAS,QAAQ,cAAc,CAAA,CACrC,EAEM,OADS,IAAI,gBAAgBC,CAAI,CACjC,CACP,CACH"}